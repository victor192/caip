# caip
[MTA] CAIP - Check another IP

#Описание
Ресурс проверяет строку на наличие в ней постороннего IP-адреса и порта. Алгоритм поиска основан на перебирании
последовательных комбинаций символов цифр из проверяемой строки. Доступны настройки, связанные с маской IP-адреса
и диапазоном портов. Ресурс экспортирует серверную функцию *checkAnotherIP* для проверки строки на
совпадения вида ip:port, а также серверное событие *onAnotherIPInChat*, проверяющее сообщения
чата на наличие подобных совпадений.

#Настройки (файл meta.xml)
* ##Группа настроек, связанная с IP-адресом и портом вашего MTA сервера.
  * ###ServerIP
    IP-адрес вашего MTA сервера.

  * ###ServerPort
    Порт вашего MTA сервера.

* ##Группа настроек, связанная с маской проверяемого IP-адреса. 
  * ###FirstIPNumberMinRange
    Минимальное значение первой цифры проверяемого IP-адреса. Должно быть целым числом от 0 до 255.

  * ###FirstIPNumberMaxRange
    Максимальное значение первой цифры проверяемого IP-адреса. Должно быть целым числом от 0 до 255 и большим чем значение *FirstIPNumberMinRange*.
    
  * ###SecondIPNumberMinRange
    Минимальное значение второй цифры проверяемого IP-адреса. Должно быть целым числом от 0 до 255.

  * ###SecondIPNumberMaxRange
    Максимальное значение второй цифры проверяемого IP-адреса. Должно быть целым числом от 0 до 255 и большим чем значение *SecondIPNumberMinRange*.
    
  * ###ThirdIPNumberMinRange
    Минимальное значение третьей цифры проверяемого IP-адреса. Должно быть целым числом от 0 до 255.

  * ###ThirdIPNumberMaxRange
    
  * ###FourthIPNumberMinRange
    Минимальное значение четвертой цифры проверяемого IP-адреса. Должно быть целым числом от 0 до 255.

  * ###FourthIPNumberMaxRange
    Максимальное значение четвертой цифры проверяемого IP-адреса. Должно быть целым числом от 0 до 255 и большим чем значение *FourthIPNumberMinRange*.
    
* ##Группа настроек, связанная с диапазоном портов.

  * ###PortMinRange
    Минимальное значение проверяемого порта. Должно быть целым числом, большим нуля.

  * ###PortMaxRange
    Максимальное значение проверяемого порта. Должно быть целым числом, большим чем значение *PortMinRange*.
    
* ##NotDgitsWordsMaxLength
  Максимальная длина подстроки, расположенной между цифрами в совпадении вида ip:port.

#Экспортируемые функции
* ##checkAnotherIP
  Проверяет строку на наличие в ней посторонней комбинации вида ip:port. Сравнение найденных комбинаций
  производится с данными IP-адреса и порта, указанными в настройках ресурса.

  * ###Тип
    Серверная функция

  * ###Синтаксис:
    >table **checkAnotherIP**(string **theString**)

  * ###Аргументы:
    * **theString**:
    Строка для проверки.

  * ###Возвращаемое значение:
    Возвращает таблицу, содержащую ключи `ErrorCode` и `Checked`. В случае успешного выполнения `ErrorCode`
    должен быть равен *0*. Результат проверки строки записывается в ключ `Checked`. Если `Checked` равен *true*, то
    строка содержит постороннюю комбинацию вида ip:port, *false* в противном случае. В случае `Checked` равного *true*,
    дополнительно возвращаются ключи `IP` и `Port`, содержащие данные найденного в строке IP-адреса и порта.

#Экспортируемые события
* ##onAnotherIPInChat
  Данное событие срабатывает, если при отправке игроком сообщения в чат обнаружена посторонняя
  комбинация вида ip:порт. В качестве проверяемых данных используются никнейм игрока и отправляемое сообщение.

  * ###Тип
    Серверное событие

  * ###Параметры:
    >string **ip**, string **port**
    * *ip*: Найденный при отправке IP-адрес.
    * *port*: Найденный при отправке порт.

  * ###Элемент source
    Элементом *source* данного события является элемент игрока, отправившего сообщение в чат.
